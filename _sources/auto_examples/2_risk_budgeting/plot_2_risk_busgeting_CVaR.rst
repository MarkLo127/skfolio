
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/2_risk_budgeting/plot_2_risk_busgeting_CVaR.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_2_risk_budgeting_plot_2_risk_busgeting_CVaR.py>`
        to download the full example code or to run this example in your browser via Binder

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_2_risk_budgeting_plot_2_risk_busgeting_CVaR.py:


=====================
Risk Budgeting - CVaR
=====================

This tutorial uses the :class:`~skfolio.optimization.RiskBudgeting` optimization to
build a risk budgeting portfolio by specifying a risk budget on each asset with CVaR as
the risk measure.

.. GENERATED FROM PYTHON SOURCE LINES 12-16

Data
====
We load the S&P 500 :ref:`dataset <datasets>` composed of the daily prices of 20
assets from the S&P 500 Index composition starting from 1990-01-02 up to 2022-12-28:

.. GENERATED FROM PYTHON SOURCE LINES 16-30

.. code-block:: Python


    from plotly.io import show
    from sklearn.model_selection import train_test_split

    from skfolio import Population, RiskMeasure
    from skfolio.datasets import load_sp500_dataset
    from skfolio.optimization import InverseVolatility, RiskBudgeting
    from skfolio.preprocessing import prices_to_returns

    prices = load_sp500_dataset()

    X = prices_to_returns(prices)
    X_train, X_test = train_test_split(X, test_size=0.33, shuffle=False)








.. GENERATED FROM PYTHON SOURCE LINES 31-35

Risk Budget
===========
We chose the following risk budget: 1.5 on Apples, 0.2 on General Electric and
JPMorgan and 1.0 on the remaining assets:

.. GENERATED FROM PYTHON SOURCE LINES 35-40

.. code-block:: Python

    risk_budget = {asset_name: 1 for asset_name in X.columns}
    risk_budget["AAPL"] = 1.5
    risk_budget["GE"] = 0.2
    risk_budget["JPM"] = 0.2








.. GENERATED FROM PYTHON SOURCE LINES 41-44

Model
=====
We create the risk budgeting model and then fit it on the training set:

.. GENERATED FROM PYTHON SOURCE LINES 44-52

.. code-block:: Python

    model = RiskBudgeting(
        risk_measure=RiskMeasure.CVAR,
        risk_budget=risk_budget,
        portfolio_params=dict(name="Risk Budgeting - CVaR"),
    )
    model.fit(X_train)
    model.weights_





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array([0.06173109, 0.0325744 , 0.03336025, 0.03994727, 0.06348992,
           0.00930168, 0.04579238, 0.06880723, 0.00765283, 0.06700223,
           0.05537244, 0.05430778, 0.04828169, 0.07033671, 0.05371219,
           0.06892884, 0.04230966, 0.04897376, 0.06251597, 0.06560167])



.. GENERATED FROM PYTHON SOURCE LINES 53-55

To compare this model, we use an inverse volatility benchmark using
the :class:`~skfolio.optimization.InverseVolatility` estimator:

.. GENERATED FROM PYTHON SOURCE LINES 55-59

.. code-block:: Python

    bench = InverseVolatility(portfolio_params=dict(name="Inverse Vol"))
    bench.fit(X_train)
    bench.weights_





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array([0.03306735, 0.02548697, 0.03551377, 0.0296872 , 0.06358463,
           0.05434705, 0.04742354, 0.07049715, 0.03882539, 0.06697905,
           0.05570808, 0.05576851, 0.04723274, 0.06351213, 0.05581397,
           0.0676481 , 0.02564642, 0.03970752, 0.05744543, 0.06610498])



.. GENERATED FROM PYTHON SOURCE LINES 60-65

Risk Contribution Analysis
==========================
Let's analyze the risk contribution of both models on the training set.
As expected, the risk budgeting model has 50% more CVaR contribution to Apple and 80%
less to General Electric and JPMorgan compared to the other assets:

.. GENERATED FROM PYTHON SOURCE LINES 65-69

.. code-block:: Python

    ptf_model_train = model.predict(X_train)
    fig = ptf_model_train.plot_contribution(measure=RiskMeasure.CVAR)
    show(fig)




.. raw:: html
    :file: images/sphx_glr_plot_2_risk_busgeting_CVaR_001.html





.. GENERATED FROM PYTHON SOURCE LINES 70-73

|

And the inverse volatility model has different CVaR contribution for each asset:

.. GENERATED FROM PYTHON SOURCE LINES 73-76

.. code-block:: Python

    ptf_bench_train = bench.predict(X_train)
    ptf_bench_train.plot_contribution(measure=RiskMeasure.CVAR)






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>                        <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
            <script charset="utf-8" src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>                <div id="42e14483-5988-40f8-8f3d-8525821c8946" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("42e14483-5988-40f8-8f3d-8525821c8946")) {                    Plotly.newPlot(                        "42e14483-5988-40f8-8f3d-8525821c8946",                        [{"alignmentgroup":"True","hovertemplate":"variable=contribution\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"contribution","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"contribution","offsetgroup":"contribution","orientation":"v","showlegend":true,"textposition":"auto","x":["AAPL","AMD","BAC","BBY","CVX","GE","HD","JNJ","JPM","KO","LLY","MRK","MSFT","PEP","PFE","PG","RRC","UNH","WMT","XOM"],"xaxis":"x","y":[0.0010490738043746064,0.0010389126104792918,0.0015218220257088456,0.0009558777565696232,0.0013985508194198114,0.0017269892214715876,0.0014293318870294664,0.0013989347574741913,0.0015434820358882436,0.0013568813161201022,0.0013791159139533086,0.0014561566693173397,0.001367439526619724,0.001205971398870021,0.001430356021088381,0.0013241888395322064,0.0007095565776223209,0.0010891858774061958,0.001252150181499712,0.0014115320967132859],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Asset"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"CVaR contribution"}},"legend":{"title":{"text":"variable"},"tracegroupgap":0},"margin":{"t":60},"barmode":"relative","title":{"text":"CVaR contribution"}},                        {"responsive": true}                    )                };                            </script>        </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 77-80

Prediction
==========
We predict the model and the benchmark on the test set:

.. GENERATED FROM PYTHON SOURCE LINES 80-83

.. code-block:: Python

    ptf_model_test = model.predict(X_test)
    ptf_bench_test = bench.predict(X_test)








.. GENERATED FROM PYTHON SOURCE LINES 84-88

Analysis
========
For improved analysis, it's possible to load both predicted portfolios into a
:class:`~skfolio.population.Population`:

.. GENERATED FROM PYTHON SOURCE LINES 88-90

.. code-block:: Python

    population = Population([ptf_model_test, ptf_bench_test])








.. GENERATED FROM PYTHON SOURCE LINES 91-92

Let's plot each portfolio composition:

.. GENERATED FROM PYTHON SOURCE LINES 92-94

.. code-block:: Python

    population.plot_composition()






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>                        <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
            <script charset="utf-8" src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>                <div id="10a1a5fb-8dfe-40f3-afa1-e6023c249409" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("10a1a5fb-8dfe-40f3-afa1-e6023c249409")) {                    Plotly.newPlot(                        "10a1a5fb-8dfe-40f3-afa1-e6023c249409",                        [{"alignmentgroup":"True","hovertemplate":"asset=PEP\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"PEP","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"PEP","offsetgroup":"PEP","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.07033671425810771,0.06351213180023674],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=PG\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"PG","marker":{"color":"#EF553B","pattern":{"shape":""}},"name":"PG","offsetgroup":"PG","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.06892883776913548,0.06764810119677168],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=JNJ\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"JNJ","marker":{"color":"#00cc96","pattern":{"shape":""}},"name":"JNJ","offsetgroup":"JNJ","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.06880722912367161,0.07049714926687088],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=KO\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"KO","marker":{"color":"#ab63fa","pattern":{"shape":""}},"name":"KO","offsetgroup":"KO","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.06700222930649696,0.06697905157999877],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=XOM\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"XOM","marker":{"color":"#FFA15A","pattern":{"shape":""}},"name":"XOM","offsetgroup":"XOM","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.06560166941026946,0.06610498361884795],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=CVX\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"CVX","marker":{"color":"#19d3f3","pattern":{"shape":""}},"name":"CVX","offsetgroup":"CVX","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.0634899176660889,0.06358462818293605],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=WMT\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"WMT","marker":{"color":"#FF6692","pattern":{"shape":""}},"name":"WMT","offsetgroup":"WMT","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.0625159737679211,0.05744542961420065],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=AAPL\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"AAPL","marker":{"color":"#B6E880","pattern":{"shape":""}},"name":"AAPL","offsetgroup":"AAPL","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.061731093019585,0.0330673489002659],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=LLY\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"LLY","marker":{"color":"#FF97FF","pattern":{"shape":""}},"name":"LLY","offsetgroup":"LLY","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.05537243888029937,0.05570808491474122],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=MRK\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"MRK","marker":{"color":"#FECB52","pattern":{"shape":""}},"name":"MRK","offsetgroup":"MRK","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.05430778249469645,0.05576850648553162],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=PFE\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"PFE","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"PFE","offsetgroup":"PFE","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.053712187983049435,0.05581397198857017],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=UNH\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"UNH","marker":{"color":"#EF553B","pattern":{"shape":""}},"name":"UNH","offsetgroup":"UNH","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.04897376425523748,0.03970752143015247],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=MSFT\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"MSFT","marker":{"color":"#00cc96","pattern":{"shape":""}},"name":"MSFT","offsetgroup":"MSFT","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.04828168988353248,0.04723274229784657],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=HD\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"HD","marker":{"color":"#ab63fa","pattern":{"shape":""}},"name":"HD","offsetgroup":"HD","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.045792380609937705,0.0474235436226737],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=RRC\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"RRC","marker":{"color":"#FFA15A","pattern":{"shape":""}},"name":"RRC","offsetgroup":"RRC","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.042309663899822526,0.025646421315362548],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=BBY\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"BBY","marker":{"color":"#19d3f3","pattern":{"shape":""}},"name":"BBY","offsetgroup":"BBY","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.03994726571875707,0.029687204219557388],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=BAC\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"BAC","marker":{"color":"#FF6692","pattern":{"shape":""}},"name":"BAC","offsetgroup":"BAC","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.03336025028367548,0.03551376692721911],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=AMD\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"AMD","marker":{"color":"#B6E880","pattern":{"shape":""}},"name":"AMD","offsetgroup":"AMD","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.03257439888387365,0.025486971108183286],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=GE\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"GE","marker":{"color":"#FF97FF","pattern":{"shape":""}},"name":"GE","offsetgroup":"GE","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.009301684169282476,0.05434705209849313],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"asset=JPM\u003cbr\u003eindex=%{x}\u003cbr\u003evalue=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"JPM","marker":{"color":"#FECB52","pattern":{"shape":""}},"name":"JPM","offsetgroup":"JPM","orientation":"v","showlegend":true,"textposition":"auto","x":["Risk Budgeting - CVaR","Inverse Vol"],"xaxis":"x","y":[0.00765282861655961,0.03882538943154023],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Portfolios"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Weight"},"tickformat":",.0%"},"legend":{"title":{"text":"asset"},"tracegroupgap":0,"yanchor":"top","y":0.99,"xanchor":"left","x":1.15},"margin":{"t":60},"barmode":"relative","title":{"text":"Portfolios Composition"}},                        {"responsive": true}                    )                };                            </script>        </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 95-96

Let's plot each portfolio cumulative returns:

.. GENERATED FROM PYTHON SOURCE LINES 96-99

.. code-block:: Python

    fig = population.plot_cumulative_returns()
    show(fig)




.. raw:: html
    :file: images/sphx_glr_plot_2_risk_busgeting_CVaR_002.html





.. GENERATED FROM PYTHON SOURCE LINES 100-103

|

Finally, we print a full summary of both strategies evaluated on the test set:

.. GENERATED FROM PYTHON SOURCE LINES 103-104

.. code-block:: Python

    population.summary()





.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>Risk Budgeting - CVaR</th>
          <th>Inverse Vol</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>Mean</th>
          <td>0.067%</td>
          <td>0.064%</td>
        </tr>
        <tr>
          <th>Annualized Mean</th>
          <td>17.00%</td>
          <td>16.06%</td>
        </tr>
        <tr>
          <th>Variance</th>
          <td>0.010%</td>
          <td>0.010%</td>
        </tr>
        <tr>
          <th>Annualized Variance</th>
          <td>2.57%</td>
          <td>2.56%</td>
        </tr>
        <tr>
          <th>Semi-Variance</th>
          <td>0.0052%</td>
          <td>0.0053%</td>
        </tr>
        <tr>
          <th>Annualized Semi-Variance</th>
          <td>1.32%</td>
          <td>1.33%</td>
        </tr>
        <tr>
          <th>Standard Deviation</th>
          <td>1.01%</td>
          <td>1.01%</td>
        </tr>
        <tr>
          <th>Annualized Standard Deviation</th>
          <td>16.02%</td>
          <td>16.00%</td>
        </tr>
        <tr>
          <th>Semi-Deviation</th>
          <td>0.72%</td>
          <td>0.73%</td>
        </tr>
        <tr>
          <th>Annualized Semi-Deviation</th>
          <td>11.50%</td>
          <td>11.54%</td>
        </tr>
        <tr>
          <th>Mean Absolute Deviation</th>
          <td>0.65%</td>
          <td>0.65%</td>
        </tr>
        <tr>
          <th>CVaR at 95%</th>
          <td>2.33%</td>
          <td>2.35%</td>
        </tr>
        <tr>
          <th>EVaR at 95%</th>
          <td>5.12%</td>
          <td>5.29%</td>
        </tr>
        <tr>
          <th>Worst Realization</th>
          <td>10.08%</td>
          <td>10.49%</td>
        </tr>
        <tr>
          <th>CDaR at 95%</th>
          <td>12.03%</td>
          <td>12.22%</td>
        </tr>
        <tr>
          <th>MAX Drawdown</th>
          <td>32.78%</td>
          <td>34.83%</td>
        </tr>
        <tr>
          <th>Average Drawdown</th>
          <td>2.34%</td>
          <td>2.34%</td>
        </tr>
        <tr>
          <th>EDaR at 95%</th>
          <td>18.98%</td>
          <td>20.05%</td>
        </tr>
        <tr>
          <th>First Lower Partial Moment</th>
          <td>0.33%</td>
          <td>0.32%</td>
        </tr>
        <tr>
          <th>Ulcer Index</th>
          <td>0.040</td>
          <td>0.040</td>
        </tr>
        <tr>
          <th>Gini Mean Difference</th>
          <td>0.99%</td>
          <td>0.98%</td>
        </tr>
        <tr>
          <th>Value at Risk at 95%</th>
          <td>1.43%</td>
          <td>1.45%</td>
        </tr>
        <tr>
          <th>Drawdown at Risk at 95%</th>
          <td>8.81%</td>
          <td>8.79%</td>
        </tr>
        <tr>
          <th>Entropic Risk Measure at 95%</th>
          <td>3.00</td>
          <td>3.00</td>
        </tr>
        <tr>
          <th>Fourth Central Moment</th>
          <td>0.000021%</td>
          <td>0.000022%</td>
        </tr>
        <tr>
          <th>Fourth Lower Partial Moment</th>
          <td>0.000010%</td>
          <td>0.000011%</td>
        </tr>
        <tr>
          <th>Skew</th>
          <td>-0.025</td>
          <td>-0.15</td>
        </tr>
        <tr>
          <th>Kurtosis</th>
          <td>20.32</td>
          <td>21.17</td>
        </tr>
        <tr>
          <th>Sharpe Ratio</th>
          <td>0.067</td>
          <td>0.063</td>
        </tr>
        <tr>
          <th>Annualized Sharpe Ratio</th>
          <td>1.06</td>
          <td>1.00</td>
        </tr>
        <tr>
          <th>Sortino Ratio</th>
          <td>0.093</td>
          <td>0.088</td>
        </tr>
        <tr>
          <th>Annualized Sortino Ratio</th>
          <td>1.48</td>
          <td>1.39</td>
        </tr>
        <tr>
          <th>Mean Absolute Deviation Ratio</th>
          <td>0.10</td>
          <td>0.098</td>
        </tr>
        <tr>
          <th>First Lower Partial Moment Ratio</th>
          <td>0.21</td>
          <td>0.20</td>
        </tr>
        <tr>
          <th>Value at Risk Ratio at 95%</th>
          <td>0.047</td>
          <td>0.044</td>
        </tr>
        <tr>
          <th>CVaR Ratio at 95%</th>
          <td>0.029</td>
          <td>0.027</td>
        </tr>
        <tr>
          <th>Entropic Risk Measure Ratio at 95%</th>
          <td>0.00023</td>
          <td>0.00021</td>
        </tr>
        <tr>
          <th>EVaR Ratio at 95%</th>
          <td>0.013</td>
          <td>0.012</td>
        </tr>
        <tr>
          <th>Worst Realization Ratio</th>
          <td>0.0067</td>
          <td>0.0061</td>
        </tr>
        <tr>
          <th>Drawdown at Risk Ratio at 95%</th>
          <td>0.0077</td>
          <td>0.0073</td>
        </tr>
        <tr>
          <th>CDaR Ratio at 95%</th>
          <td>0.0056</td>
          <td>0.0052</td>
        </tr>
        <tr>
          <th>Calmar Ratio</th>
          <td>0.0021</td>
          <td>0.0018</td>
        </tr>
        <tr>
          <th>Average Drawdown Ratio</th>
          <td>0.029</td>
          <td>0.027</td>
        </tr>
        <tr>
          <th>EDaR Ratio at 95%</th>
          <td>0.0036</td>
          <td>0.0032</td>
        </tr>
        <tr>
          <th>Ulcer Index Ratio</th>
          <td>0.017</td>
          <td>0.016</td>
        </tr>
        <tr>
          <th>Gini Mean Difference Ratio</th>
          <td>0.068</td>
          <td>0.065</td>
        </tr>
        <tr>
          <th>Assets number</th>
          <td>20</td>
          <td>20</td>
        </tr>
      </tbody>
    </table>
    </div>
    </div>
    <br />
    <br />


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 1.868 seconds)


.. _sphx_glr_download_auto_examples_2_risk_budgeting_plot_2_risk_busgeting_CVaR.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: binder-badge

      .. image:: images/binder_badge_logo.svg
        :target: https://mybinder.org/v2/gh/skfolio/skfolio/gh-pages?urlpath=lab/tree/notebooks/auto_examples/2_risk_budgeting/plot_2_risk_busgeting_CVaR.ipynb
        :alt: Launch binder
        :width: 150 px

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_2_risk_busgeting_CVaR.ipynb <plot_2_risk_busgeting_CVaR.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_2_risk_busgeting_CVaR.py <plot_2_risk_busgeting_CVaR.py>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
